# 「プラグインマネージャー」プラグインに関するアイデアと考察

## 1. 発端：プラグイン管理のアイデア

ユーザーがトイレで思いついたアイデアとして、「プラグイン自体を管理するためのプラグイン（プラグインマネージャー）を作る」という構想が提示された。

これは、`plugins.js` を直接編集するのではなく、エディタのUI上から各プラグインの有効/無効を切り替えたり、設定を変更したりできるようにする機能である。

---

## 2. 課題：自己参照と無限ループの懸念

アイデアの直後、ユーザー自身から「プラグインマネージャーが自分自身を管理対象にしてしまった場合、エラーや無限ループに陥るのではないか？」という鋭い懸念点が挙げられた。

例えば、プラグインマネージャーを使って、プラグインマネージャー自身を「無効」にしてしまうと、二度と有効に戻せなくなる、といった問題が考えられる。

---

## 3. 解決策の検討

この課題を解決するために、いくつかの方法が検討された。

### 解決策1：特別な存在として扱う

-   **方法:**
    プラグインマネージャーを、他の一般的なプラグインとは明確に区別する。
    -   **一般プラグイン:** `plugins.js` のリストに基づいて、エディタが動的に読み込む。
    -   **プラグインマネージャー:** `plugins.js` には記載せず、エディタのコア機能の一部として、`editor.js` などが直接的に読み込む。
-   **利点:**
    管理する側（マネージャー）と管理される側（一般プラグイン）が完全に分離されるため、自己参照の問題を確実に防ぐことができる。
-   **例え:**
    Linuxの`sudo`の仕組み。`sudo`というコマンド自体（エディタコア）と、`sudoers`ファイルで権限を与えられた管理者アカウント（プラグインマネージャー）の関係に近い。

### 解決策2：特別な「クラス（役割）」を与える（より洗練された方法）

-   **方法:**
    すべてのプラグインは `plugins.js` で一元管理する。その上で、プラグインマネージャーにだけ特別な「しるし（プロパティ）」を付与する。

    ```javascript
    // plugins.js での設定例
    const enabledPlugins = [
        {
            name: 'プラグインマネージャー',
            path: 'plugins/manager/manager-plugin.js',
            className: 'PluginManagerPlugin',
            isCore: true, // ★「コア機能」であるという特別な "しるし"
            enabled: true
        },
        {
            name: '縦書きプラグイン',
            path: 'plugins/vertical-writing/vertical-writing-plugin.js',
            className: 'VerticalWritingPlugin',
            isCore: false, // 一般的なプラグイン
            enabled: true
        }
    ];
    ```

-   **振る舞い:**
    プラグインマネージャー自身が、プラグインの一覧を表示する際に、`isCore: true` の "しるし" がついたプラグイン（自分自身など）を管理対象のリストから除外するように実装する。

-   **利点:**
    -   **情報の一元化:** すべてのプラグイン情報を `plugins.js` だけで管理でき、見通しが良い。
    -   **高い柔軟性:** 将来、「絶対に無効化してはいけない」他の重要プラグインが登場した場合も、同じ `isCore: true` の "しるし" を付けるだけで簡単に対象から除外できる。

---

## 4. 結論

**解決策2** の「特別なクラス（役割）を与える」方法が、より柔軟で拡張性も高く、優れたアプローチであるという結論に至った。
